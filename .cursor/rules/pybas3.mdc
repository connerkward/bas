---
description: PyBas3 project rules for AI-powered development
alwaysApply: true
---

# Cursor AI Rules for PyBas3

## Key Files
| Purpose | File |
|---------|------|
| Tasks & handoff | `PyBas3/agents/SESSION.md` |
| Contracts & protocols | `PyBas3/agents/AGENT_0_SHARED.md` |
| Technical reference | `PyBas3/TECHNICAL_REFERENCE.md` |
| Agent status | `PyBas3/agents/status/` |

## Command Handlers

### When user says "spin up"
1. Read `PyBas3/agents/SESSION.md` for context + tasks
2. **Claim role:**
   - If user specified (e.g. "spin up as Iris") → use that role
   - "spin up as Orchestrator" → cross-lane integration testing (can touch all modules)
   - If not specified → read `status/*` files, pick first available lane role:
     - `active: no` → available
     - `active: yes` but `last_updated` >2 hours → stale, available
   - If still unclear → ask user
3. Update YOUR status file: `status/agent_<N>_<lane>.md`
   - Set `active: yes`, `last_updated: <ISO timestamp>`, task
4. **Commit status file** (makes your claim visible to other agents)
5. Pick a task from backlog matching your lane
6. Start working following `AGENT_0_SHARED.md` contracts

### When user says "spin down"
1. **Test code changes:**
   - Run `uv run python tests/test_integration.py` for integration tests
   - Run module-specific tests if they exist
   - If testing not verifiable → **FLAG USER AND PAUSE**
   - Document test status in status file
2. Update `SESSION.md`: what changed, current state
3. Update your status file: `active: no`, summary, test status
4. **Commit changes:**
   - **If in worktree:** Commit changes (commits go to your branch, safe for merge)
   - **If NOT in worktree:** Leave changes staged/unstaged for human review (never push)

## Code Style
- Python: PEP 8, type hints preferred
- Concise comments
- No emojis in code (docs are fine)

## Package Management
- Use **UV** (`uv`) as Python package manager
- Run: `uv sync` to install deps, `uv run <script>` to execute
- Dependencies defined in `PyBas3/pyproject.toml`

## Testing
- **Always run tests before spin down:** `cd PyBas3 && uv run python tests/test_integration.py`
- Module tests: `scoring/test_scorer.py`, `mediapipe/test_vision.sh`
- Integration tests don't need camera (test shared memory + JSON)
- Full Vision/NDI end-to-end requires camera

## Architecture
- Each module = independent process
- No shared Python state; communicate via NDI, shared memory, or files
- Atomic writes (temp → rename) for persistent data

## Don't
- Modify `dist/` folders
- Git push (human does that)
- Over-engineer
- Edit another agent's status file (only your own)
